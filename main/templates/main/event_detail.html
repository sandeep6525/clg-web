{% extends "base.html" %}
{% block title %}{{ event.title }} • Event{% endblock %}

{% block extra_css %}
<style>
  /* small detail-page video styles */
  .event-media { border-radius: 0.75rem; overflow: hidden; background: #f3f4f6; }
  .event-media .media-wrapper { position: relative; padding-top: 56.25%; } /* 16:9 */
  .event-media iframe,
  .event-media video,
  .event-media img {
    position: absolute;
    left: 0; top: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    display: block;
  }

  /* If poster image shown as standalone (no video), keep nice aspect */
  .event-poster { width: 100%; max-height: 520px; object-fit: cover; border-radius: 0.5rem; }
</style>
{% endblock %}

{% block content %}
<section class="py-10">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 bg-white rounded-2xl p-6 shadow">

    <!-- Event Title -->
    <h1 class="text-3xl font-bold mb-2">{{ event.title }}</h1>
    <p class="text-gray-600 mb-4">
      {{ event.start_at|date:"M d, Y H:i" }}
      {% if event.end_at %} — {{ event.end_at|date:"M d, Y H:i" }}{% endif %}
      {% if event.venue %} • {{ event.venue }}{% endif %}
    </p>

    <!-- Media: prefer video (self-hosted) -> embed (YouTube/Vimeo) -> poster image -->
    <div class="mb-6">
      {% if event.video %}
        <div class="event-media">
          <div class="media-wrapper">
            <video controls preload="metadata" {% if event.image %} poster="{{ event.image.url }}" {% endif %}>
              <source src="{{ event.video.url }}" type="video/mp4">
              {% if event.video_captions %}
                <track kind="captions" src="{{ event.video_captions.url }}" srclang="en" label="English" default>
              {% endif %}
              Your browser does not support the video tag.
            </video>
          </div>
        </div>

        <p class="text-sm text-gray-500 mt-2">
          <a href="{{ event.video.url }}" target="_blank" rel="noopener">Download / Open video file</a>
          {% if event.video_url %}
            &nbsp;•&nbsp;<a href="{{ event.video_url }}" target="_blank" rel="noopener">External link</a>
          {% endif %}
        </p>

      {% elif event.get_embed_url %}
        <div class="event-media">
          <div class="media-wrapper">
            <iframe src="{{ event.get_embed_url }}" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen title="Video for {{ event.title }}"></iframe>
          </div>
        </div>

        {% if event.video_url %}
          <p class="text-sm text-gray-500 mt-2">
            <a href="{{ event.video_url }}" target="_blank" rel="noopener">Open on provider</a>
          </p>
        {% endif %}

      {% elif event.image %}
        <img src="{{ event.image.url }}" alt="{{ event.title }}" class="event-poster rounded-lg shadow-md w-full">
      {% endif %}
    </div>

    <!-- Event Description -->
    <div class="prose max-w-none">
      {{ event.description|linebreaks }}
    </div>

    <!-- Optional meta / actions -->
    <div class="mt-6 text-sm text-gray-600">
      {% if event.is_registration_open %}
        <span class="inline-block bg-emerald-100 text-emerald-800 py-1 px-3 rounded-lg mr-2">Registration Open</span>
      {% endif %}
      <span>Created: {{ event.created_at|date:"M d, Y" }}</span>
    </div>

  </div>
</section>
{% endblock %}
